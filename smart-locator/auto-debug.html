<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªåŠ¨è°ƒè¯•é¡µé¢</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      margin: 0;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #569cd6;
      margin-bottom: 20px;
    }

    .panel {
      background: #252526;
      border: 1px solid #3c3c3c;
      border-radius: 4px;
      margin-bottom: 20px;
      padding: 15px;
    }

    .panel h2 {
      color: #4ec9b0;
      margin-top: 0;
      font-size: 16px;
    }

    .status {
      padding: 10px 15px;
      border-radius: 4px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .status.success {
      background: #0e639c;
      color: #d7ba7d;
    }

    .status.error {
      background: #f14c4c;
      color: #ffffff;
    }

    .status.info {
      background: #007acc;
      color: #ffffff;
    }

    .log-entry {
      padding: 5px 10px;
      margin: 2px 0;
      border-left: 3px solid #569cd6;
      background: #2d2d30;
      font-size: 12px;
    }

    .log-entry.error {
      border-left-color: #f14c4c;
      background: #2d2d30;
      color: #f14c4c;
    }

    .log-entry.warning {
      border-left-color: #cca700;
      background: #2d2d30;
      color: #cca700;
    }

    .log-entry.success {
      border-left-color: #4ec9b0;
      background: #2d2d30;
      color: #4ec9b0;
    }

    .log-time {
      color: #858585;
      margin-right: 10px;
    }

    .test-elements {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .test-element {
      padding: 30px;
      text-align: center;
      border: 3px solid;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      background: #252526;
    }

    .test-element:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .test-element:active {
      transform: scale(0.95);
    }

    .test-element.blue {
      border-color: #4285f4;
      color: #4285f4;
    }

    .test-element.green {
      border-color: #34a853;
      color: #34a853;
    }

    .test-element.red {
      border-color: #ea4335;
      color: #ea4335;
    }

    .test-element.yellow {
      border-color: #fbbc04;
      color: #fbbc04;
    }

    .counter {
      display: inline-block;
      padding: 2px 8px;
      background: #3c3c3c;
      border-radius: 3px;
      font-size: 11px;
      margin-left: 5px;
    }

    .clear-btn {
      background: #0e639c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 10px;
    }

    .clear-btn:hover {
      background: #1177bb;
    }

    #log-container {
      max-height: 400px;
      overflow-y: auto;
      background: #1e1e1e;
      border: 1px solid #3c3c3c;
      padding: 10px;
      border-radius: 4px;
    }

    .instructions {
      background: #3c3c3c;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #4ec9b0;
    }

    .instructions ol {
      margin: 0;
      padding-left: 20px;
    }

    .instructions li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Stage Smart Locator - è‡ªåŠ¨è°ƒè¯•é¡µé¢</h1>

    <div class="instructions">
      <h2 style="margin-top: 0; color: #4ec9b0;">ä½¿ç”¨æ­¥éª¤ï¼š</h2>
      <ol>
        <li>æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
        <li>ç‚¹å‡»"Elements"æ ‡ç­¾</li>
        <li>åœ¨å³ä¾§æ‰¾åˆ°"Stage Smart Locator"æ ‡ç­¾å¹¶ç‚¹å‡»</li>
        <li>ç‚¹å‡»"ğŸ¯ é€‰æ‹©å…ƒç´ "æŒ‰é’®</li>
        <li>å°†é¼ æ ‡ç§»åŠ¨åˆ°ä¸‹æ–¹çš„å½©è‰²æ–¹å—ä¸Š</li>
        <li>ç‚¹å‡»æ–¹å—</li>
        <li>è§‚å¯Ÿæœ¬é¡µé¢åº•éƒ¨çš„æ—¥å¿—è¾“å‡º</li>
      </ol>
    </div>

    <div class="panel">
      <h2>ğŸ“Š çŠ¶æ€ç›‘æ§</h2>
      <div id="status-box" class="status info">ç­‰å¾…å¼€å§‹...</div>
      <div>
        <strong>äº‹ä»¶ç»Ÿè®¡ï¼š</strong>
        <span class="counter">ç‚¹å‡»: <span id="click-count">0</span></span>
        <span class="counter">é¼ æ ‡æ‚¬åœ: <span id="hover-count">0</span></span>
        <span class="counter">æ¶ˆæ¯: <span id="message-count">0</span></span>
      </div>
    </div>

    <div class="panel">
      <h2>ğŸ“ å®æ—¶æ—¥å¿—</h2>
      <div id="log-container">
        <!-- æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
      </div>
      <button class="clear-btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="panel">
      <h2>ğŸ§ª æµ‹è¯•å…ƒç´ </h2>
      <div class="test-elements">
        <div id="element1" class="test-element blue">
          å…ƒç´  1<br>
          <small>id="element1"</small>
        </div>
        <div id="element2" class="test-element green">
          å…ƒç´  2<br>
          <small>id="element2"</small>
        </div>
        <div id="element3" class="test-element red">
          å…ƒç´  3<br>
          <small>id="element3"</small>
        </div>
        <div id="element4" class="test-element yellow">
          å…ƒç´  4<br>
          <small>id="element4"</small>
        </div>
        <div class="test-element" style="border-color: #9333ea; color: #9333ea;">
          å…ƒç´  5<br>
          <small>æ— ID</small>
        </div>
        <div class="test-element" style="border-color: #f97316; color: #f97316;">
          å…ƒç´  6<br>
          <small>class="custom"</small>
        </div>
      </div>
    </div>
  </div>

  <script>
    const logContainer = document.getElementById('log-container');
    const statusBox = document.getElementById('status-box');
    const clickCount = document.getElementById('click-count');
    const hoverCount = document.getElementById('hover-count');
    const messageCount = document.getElementById('message-count');

    let clickCounter = 0;
    let hoverCounter = 0;
    let messageCounter = 0;

    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = `log-entry ${type}`;
      div.innerHTML = `<span class="log-time">[${timestamp}]</span> ${message}`;
      logContainer.appendChild(div);
      logContainer.scrollTop = logContainer.scrollHeight;
      
      // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
      console.log(`[Auto Debug] ${message}`);
    }

    function updateStatus(message, type = 'info') {
      statusBox.textContent = message;
      statusBox.className = `status ${type}`;
      addLog(`çŠ¶æ€æ›´æ–°: ${message}`, type);
    }

    function clearLogs() {
      logContainer.innerHTML = '';
      addLog('æ—¥å¿—å·²æ¸…ç©º');
    }

    // ç›‘å¬é¡µé¢äº‹ä»¶
    document.addEventListener('DOMContentLoaded', () => {
      addLog('=== é¡µé¢å·²åŠ è½½ ===', 'success');
      updateStatus('é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…æ“ä½œ', 'success');
    });

    // ç›‘å¬æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', (e) => {
      clickCounter++;
      clickCount.textContent = clickCounter;
      
      const target = e.target;
      const id = target.id || '(æ— ID)';
      const className = target.className;
      const tagName = target.tagName.toLowerCase();
      
      addLog(`ç‚¹å‡»äº‹ä»¶: ${tagName}${id ? '#' + id : ''}.${className.split(' ').join('.')}`, 'info');
      
      // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†æµ‹è¯•å…ƒç´ 
      if (target.classList.contains('test-element')) {
        addLog(`â†’ æµ‹è¯•å…ƒç´ è¢«ç‚¹å‡»: ${target.textContent.split('\n')[0]}`, 'success');
      }
    }, true);

    // ç›‘å¬é¼ æ ‡æ‚¬åœäº‹ä»¶
    document.addEventListener('mouseover', (e) => {
      if (e.target.classList.contains('test-element')) {
        hoverCounter++;
        hoverCount.textContent = hoverCounter;
        const id = e.target.id || '(æ— ID)';
        addLog(`é¼ æ ‡æ‚¬åœ: ${e.target.tagName.toLowerCase()}${id ? '#' + id : ''}`, 'warning');
      }
    });

    // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      messageCounter++;
      messageCount.textContent = messageCounter;
      
      addLog(`æ”¶åˆ°æ‰©å±•æ¶ˆæ¯: ${JSON.stringify(message)}`, 'warning');
      
      // æ›´æ–°çŠ¶æ€
      if (message.type === 'START_SELECT_MODE') {
        updateStatus('é€‰æ‹©æ¨¡å¼å·²å¯åŠ¨ - è¯·ç‚¹å‡»ä¸‹æ–¹å…ƒç´ ', 'success');
      } else if (message.type === 'STOP_SELECT_MODE') {
        updateStatus('é€‰æ‹©æ¨¡å¼å·²åœæ­¢', 'info');
      } else if (message.type === 'ELEMENT_SELECTED') {
        updateStatus('å…ƒç´ å·²è¢«é€‰ä¸­ - æ£€æŸ¥å®šä½å™¨ç”Ÿæˆ', 'success');
        addLog(`å®šä½å™¨: ${message.data?.locator || 'æœªç”Ÿæˆ'}`, 'success');
      } else if (message.type === 'STATUS') {
        updateStatus(`æ‰©å±•çŠ¶æ€: ${message.data}`, 'info');
      }
      
      return true;
    });

    // æµ‹è¯•å‘é€æ¶ˆæ¯åˆ°æ‰©å±•
    function testExtensionConnection() {
      addLog('æµ‹è¯•æ‰©å±•è¿æ¥...', 'info');
      chrome.runtime.sendMessage({
        type: 'PING',
        data: 'Ping from auto-debug page'
      }, (response) => {
        if (chrome.runtime.lastError) {
          addLog(`è¿æ¥é”™è¯¯: ${chrome.runtime.lastError.message}`, 'error');
          updateStatus('æ‰©å±•è¿æ¥å¤±è´¥', 'error');
        } else {
          addLog(`æ‰©å±•å“åº”: ${JSON.stringify(response)}`, 'success');
          updateStatus('æ‰©å±•è¿æ¥æ­£å¸¸', 'success');
        }
      });
    }

    // å®šæœŸæ£€æŸ¥æ‰©å±•çŠ¶æ€
    function checkExtensionStatus() {
      addLog('æ£€æŸ¥æ‰©å±•çŠ¶æ€...', 'info');
      
      // æ£€æŸ¥æ˜¯å¦åœ¨æ‰©å±•ç¯å¢ƒ
      if (typeof chrome !== 'undefined' && chrome.runtime) {
        addLog('Chromeæ‰©å±•APIå¯ç”¨', 'success');
        testExtensionConnection();
      } else {
        addLog('Chromeæ‰©å±•APIä¸å¯ç”¨', 'error');
        updateStatus('æ‰©å±•APIä¸å¯ç”¨', 'error');
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    window.addEventListener('load', () => {
      addLog('çª—å£åŠ è½½å®Œæˆ', 'success');
      
      setTimeout(() => {
        checkExtensionStatus();
      }, 1000);
      
      // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
      setInterval(() => {
        if (messageCounter === 0) {
          addLog('æœªæ”¶åˆ°ä»»ä½•æ‰©å±•æ¶ˆæ¯ - è¯·æ£€æŸ¥æ‰©å±•æ˜¯å¦æ­£ç¡®åŠ è½½', 'warning');
        }
      }, 5000);
    });

    // æ·»åŠ åˆå§‹æ—¥å¿—
    addLog('=== è‡ªåŠ¨è°ƒè¯•ç³»ç»Ÿå·²å¯åŠ¨ ===', 'info');
    addLog('è¯·æŒ‰ç…§ä¸Šæ–¹æ­¥éª¤æ“ä½œ', 'info');
  </script>
</body>
</html>
